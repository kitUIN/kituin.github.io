---
title: åˆ›å»ºnugetåŒ…(C++/WinRT)
permalink: /text/tech/C++WinRT/01
categories: 
  - æ–‡ç« 
  - æŠ€æœ¯å¤§å‘
  - C++/WinRT
tags:
  - C++/WinRT
  - C++
  - WinRT
  - Nuget
  - Visual Studio 2022
  - UWP
article: true
comment: true
author: 
  name: kitUIN
  link: https://github.com/kitUIN
date: 2022-05-17 20:56:14
---
![nuget](/img/bikaclient.png) 
<!-- more -->
## å‡†å¤‡å·¥ä½œ
é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡å¥½[`Visual Studio 2022`](https://visualstudio.microsoft.com/zh-hans/vs/)ä¸[`nuget.exe`](https://nuget.org/downloads)   
::: tip
`nuget.exe`éœ€è¦åŠ åˆ°ç³»ç»Ÿ`Path`ä¸­ 
:::

## ä»£ç ç”Ÿæˆ
### UWPé¡¹ç›®
æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ª`Windows è¿è¡Œæ—¶ç»„ä»¶`(`Windows Runtime Component`) é¡¹ç›®  
![Windows è¿è¡Œæ—¶ç»„ä»¶](/img/winrc.png)  
### ç¼–è¯‘å™¨è®¾ç½®
ç„¶åè®¾ç½®è¾“å‡ºæ³¨é‡Šæ–‡ä»¶,ä»¥å®ç°æ³¨é‡Šè¯´æ˜  
`é¡¹ç›®` â†’ `å±æ€§` ç„¶åæŒ‰ä¸‹å›¾è®¾ç½®  
![è¾“å‡ºxmlæ–‡ä»¶](/img/sxml.png)  
### ç¼–è¯‘ä»£ç 
ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ‰“åŒ…æˆ‘ä»¬çš„ä»£ç äº†  
`ç”Ÿæˆ` â†’ `æ‰¹ç”Ÿæˆ` ç„¶åæŒ‰è‡ªå·±éœ€è¦çš„å¹³å°è®¾ç½®éœ€è¦ç”Ÿæˆçš„ä»£ç (æœ¬æ–‡ä»¥æ‰€æœ‰å¹³å°è¿›è¡Œç¤ºä¾‹)  
![æ‰¹ç”Ÿæˆ](/img/scxm.png)  

## æ‰“åŒ…æˆnuget
### åˆ›å»ºå¹¶æ›´æ–°`.nuspec`æ–‡ä»¶
é¦–å…ˆå±•ç¤ºæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„:
```tree title=Project
ğŸ“¦ BikaClient              # é¡¹ç›®åç§°
â”œâ”€â”€ ğŸ“‚ BikaClient          # ä¸»ä½“ä»£ç 
â”‚   â””â”€â”€ ...                
â”œâ”€â”€ ğŸ“‚ ARM                 # ç¼–è¯‘å®Œçš„ä»£ç 
â”œâ”€â”€ ğŸ“‚ ARM64               # ç¼–è¯‘å®Œçš„ä»£ç 
â”œâ”€â”€ ğŸ“‚ x64                 # ç¼–è¯‘å®Œçš„ä»£ç 
â”œâ”€â”€ ğŸ“‚ Release             # ç¼–è¯‘å®Œçš„ä»£ç 
â”œâ”€â”€ ğŸ“œ BikaClient.sln      # è§£å†³æ–¹æ¡ˆ
â”œâ”€â”€ ğŸ“œ BikaClient.targets
â”œâ”€â”€ ğŸ“œ BikaClient.nuspec
â””â”€â”€ ğŸ“œ ...                 
```
æˆ‘ä»¬åœ¨å½“å‰ç›®å½•,å³æœ‰è§£å†³æ–¹æ¡ˆ(`.sln`æ–‡ä»¶)çš„æ–‡ä»¶å¤¹é‡Œåˆ›å»º`BikaClient.nuspec`æ–‡ä»¶(`BikaClient`æ¢æˆä½ é¡¹ç›®åç§°)  
ä¹Ÿå¯ä»¥åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­ç›´æ¥ä½¿ç”¨æŒ‡ä»¤ç”Ÿæˆ  
```shell
nuget spec
```
åœ¨æ–‡ä»¶ä¸­é”®å…¥  
```xml
<?xml version="1.0"?>
<package >
  <metadata>
    <id>BikaClient</id>
    <version>0.0.3</version>
    <title>BikaClient</title>
    <authors>KitUIN</authors>
    <owners>KitUIN</owners>
    <license type="expression">MIT</license>
    <projectUrl>https://github.com/KitUIN/BikaClient</projectUrl>
    <requireLicenseAcceptance>false</requireLicenseAcceptance>
    <description>BikaClient</description>
    <copyright>Copyright 2022-2022</copyright>
    <icon>images\small-logo.png</icon>
    <iconUrl>https://raw.githubusercontent.com/wiki/KitUIN/BikaClient/image/small-logo.png</iconUrl>
    <tags>uwp</tags>
    <dependencies>
      <group targetFramework="UAP10.0">
        <dependency id="Microsoft.UI.Xaml" version="2.7.1"/>
        <dependency id="Microsoft.Windows.CppWinRT" version="2.0.210806.1"/>
        <dependency id="VC-LTL" version="5.0.5" />
        <dependency id="YY.NuGet.Import.Helper" version="1.0.0.4" />
      </group>
    </dependencies>
  </metadata>
  <files>
    <!-- WinMd and IntelliSense files -->
    <file src=".\Release\BikaClient\BikaClient.winmd" target="lib\uap10.0"/>
    <file src=".\x64\Release\BikaClient\BikaClient.xml" target="lib\uap10.0"/>
    <!-- DLLs and resources -->
    <file src=".\ARM\Release\BikaClient\BikaClient.dll" target="runtimes\win10-arm\native"/>
    <file src=".\ARM\Release\BikaClient\BikaClient.pri" target="runtimes\win10-arm\native"/>

    <file src=".\ARM64\Release\BikaClient\BikaClient.dll" target="runtimes\win10-arm64\native"/>
    <file src=".\ARM64\Release\BikaClient\BikaClient.pri" target="runtimes\win10-arm64\native"/>

    <file src=".\x64\Release\BikaClient\BikaClient.dll" target="runtimes\win10-x64\native"/>
    <file src=".\x64\Release\BikaClient\BikaClient.pri" target="runtimes\win10-x64\native"/>

    <file src=".\Release\BikaClient\BikaClient.dll" target="runtimes\win10-x86\native"/>
    <file src=".\Release\BikaClient\BikaClient.pri" target="runtimes\win10-x86\native"/>
    <!-- .targets -->
    <file src="BikaClient.targets" target="build\native"/>
    <!-- Docs -->
    <file src=".\README.md" target="content"/>
    <file src=".\BikaClient\LICENSE" target="content"/>
    <file src=".\small-logo.png" target="images\small-logo.png" />

  </files>
</package>
```
æ¥ä¸‹æ¥è¿›è¡Œè¯´æ˜:
```tree 
package                         # åŒ…                  
â”œâ”€â”€metadata                     # å…ƒæ•°æ®                
â”‚   â”œâ”€â”€id                       # åŒ…å(å”¯ä¸€)             
â”‚   â”œâ”€â”€version                  # åŒ…ç‰ˆæœ¬                
â”‚   â”œâ”€â”€title                    # åŒ…æ˜¾ç¤ºçš„åå­—             
â”‚   â”œâ”€â”€authors                  # ä½œè€…                 
â”‚   â”œâ”€â”€owners                   # æ‰€æœ‰è€…                
â”‚   â”œâ”€â”€license                  # é¡¹ç›®æ‰€ä½¿ç”¨çš„å¼€æºè®¸å¯è¯ 
â”‚   â”œâ”€â”€requireLicenseAcceptance # æ˜¯å¦éœ€è¦æ¥å—è®¸å¯è¯          
â”‚   â”œâ”€â”€projectUrl               # é¡¹ç›®åœ°å€               
â”‚   â”œâ”€â”€description              # è¯´æ˜                 
â”‚   â”œâ”€â”€copyright                # ç‰ˆæƒè¯´æ˜               
â”‚   â”œâ”€â”€icon                     # åŒ…å›¾æ ‡                
â”‚   â”œâ”€â”€iconUrl                  # åŒ…å›¾æ ‡åœ°å€              
â”‚   â”œâ”€â”€tags                     # æ ‡ç­¾                 
â”‚   â””â”€â”€dependencies             # ä¾èµ–                 
â”‚       â””â”€â”€group                # ä¾èµ–ç»„                
â”‚           â”œâ”€â”€dependency       # ä¾èµ–1                
â”‚           â”œâ”€â”€dependency       # ä¾èµ–2                
â”‚           â””â”€â”€ ...             # ä¾èµ–...  
â””â”€â”€files                        # åŒ…å†…æ–‡ä»¶
    â””â”€â”€file                     # åŒ…å†…æ–‡ä»¶
```
`metadata`éƒ¨åˆ†ä¾æ ·ç”»è‘«èŠ¦å°±è¡Œ  
`dependencies`ä¸€èˆ¬æ˜¯æŒ‡æ‰€ä¾èµ–çš„`nuget`åº“  
åœ¨ç”Ÿæˆçš„å››ä¸ªæ–‡ä»¶å¤¹é€‰ä¸€ä¸ª`.winmd`ä¸`.xml`æŒ‰ä»¥ä¸‹ç»“æ„ä¹¦å†™,è¿™æ˜¯åŒ…çš„winmdä¸»ä½“ä»£ç   
```xml
<!-- WinMd and IntelliSense files -->
<file src=".\Release\BikaClient\BikaClient.winmd" target="lib\uap10.0"/>
<file src=".\x64\Release\BikaClient\BikaClient.xml" target="lib\uap10.0"/>
```
`.targets`æ–‡ä»¶å¾ˆé‡è¦,è¿™é‡Œæˆ‘ä»¬éœ€è¦è‡ªå·±å†™(ä¾æ—§æ˜¯`é¡¹ç›®å.targets`çš„å‘½å)
å°†ä¸‹é¢ä»£ç å¤åˆ¶,å°†é‡Œé¢`BikaClient`éƒ½æ¢æˆä½ çš„é¡¹ç›®åå­—  
```xml
<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
    <PropertyGroup>
        <BikaClient-Platform Condition="'$(Platform)' == 'Win32'">x86</BikaClient-Platform>
        <BikaClient-Platform Condition="'$(Platform)' != 'Win32'">$(Platform)</BikaClient-Platform>
    </PropertyGroup>
    <ItemGroup Condition="'$(TargetPlatformIdentifier)' == 'UAP'">
        <Reference Include="$(MSBuildThisFileDirectory)..\..\lib\uap10.0\BikaClient.winmd">
            <Implementation>BikaClient.dll</Implementation>
        </Reference>
    <ReferenceCopyLocalPaths Include="$(MSBuildThisFileDirectory)..\..\runtimes\win10-$(BikaClient-Platform)\native\BikaClient.dll" />
    </ItemGroup>
</Project>
```
éšåä¿å­˜,å¹¶ä¸”æŒ‡å®š`target`  
```xml
<!-- .targets -->
<file src="BikaClient.targets" target="build\native"/>
```
éšåå°†ä¸åŒå¹³å°çš„`.dll`æ–‡ä»¶æŒ‡å‘åŒ…å†…ä¸åŒå¹³å°çš„`target`ä¸­  
```xml
<!-- DLLs and resources -->
<file src=".\ARM\Release\BikaClient\BikaClient.dll" target="runtimes\win10-arm\native"/>
<file src=".\ARM\Release\BikaClient\BikaClient.pri" target="runtimes\win10-arm\native"/>
```
å¦‚æœæœ‰éœ€è¦,å¯ä»¥å°†æ‚é¡¹ä¹Ÿä¸€å¹¶æ”¾å…¥åŒ…ä¸­  
```xml
<!-- Docs -->
<file src=".\README.md" target="content"/>
<file src=".\BikaClient\LICENSE" target="content"/>
<file src=".\small-logo.png" target="images\small-logo.png" />
```
è‹¥è¦åœ¨ç»„ä»¶ä¸­åŒ…å«`XAMLæ§ä»¶`ï¼Œéœ€è¦æ·»åŠ å…·æœ‰é»˜è®¤æ§ä»¶æ¨¡æ¿çš„`XAMLæ–‡ä»¶`
```xml
<!-- XAML controls -->
<file src="Themes\Generic.xaml" target="lib\uap10.0\Themes"/>
```

## æ‰“åŒ…
ç›´æ¥ä½¿ç”¨å‘½ä»¤æ‰“åŒ…å³å¯
```shell
nuget pack
```
## ä¸Šä¼ 
ä¸Šä¼ ä¸ä¸€èˆ¬`nuget`åŒ…å¹¶æ— åŒºåˆ«